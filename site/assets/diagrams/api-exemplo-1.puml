@startuml
title GET /users/{id} - Obter UsuÃ¡rio por ID

actor Cliente as client
participant "API Gateway" as gateway
participant "Auth Service" as auth
participant "User Service" as user_service
participant "Database" as db
participant "Cache" as cache

client -> gateway: GET /api/v1/users/{id}
activate gateway

gateway -> auth: Validate Token
activate auth
auth --> gateway: Token Valid
deactivate auth

gateway -> user_service: getUserById(id)
activate user_service

user_service -> cache: get("user:{id}")
activate cache

alt Cache Hit
    cache --> user_service: User Data
    deactivate cache
    user_service --> gateway: User Response
else Cache Miss
    cache --> user_service: null
    deactivate cache
    
    user_service -> db: SELECT * FROM users WHERE id = {id}
    activate db
    
    alt User Found
        db --> user_service: User Data
        deactivate db
        
        user_service -> cache: set("user:{id}", data, ttl=300)
        activate cache
        cache --> user_service: OK
        deactivate cache
        
        user_service --> gateway: User Response
    else User Not Found
        db --> user_service: null
        deactivate db
        user_service --> gateway: 404 Not Found
    end
end

deactivate user_service

gateway --> client: Response (200 or 404)
deactivate gateway

@enduml

